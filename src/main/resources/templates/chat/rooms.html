<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Chat Rooms</title>
  <link rel="stylesheet" href="/webjars/bootstrap/5.3.8/css/bootstrap.min.css">
  <script src="/js/script.js"></script>
</head>

<body class="bg-light">
<div class="container py-5">
  <h2 class="mb-4 fw-bold">채팅방 목록</h2>

  <div class="card shadow-sm mb-3">
    <div class="card-body">
      <table class="table align-middle">
        <thead>
        <tr>
          <th>방 번호</th>
          <th>방 이름</th>
          <th>참여하기</th>
        </tr>
        </thead>
        <tbody id="room-tbody">
        </tbody>
      </table>

      <div class="mt-3 text-end">
        <button class="btn btn-success" id="create-room-btn">방 만들기</button>
      </div>
    </div>
  </div>
</div>

<script>
  async function loadRooms() {
    try {
      const rooms = await get('/api/chat/rooms').then(res => res.json());
      const tbody = document.getElementById('room-tbody');
      tbody.innerHTML = '';
      rooms.forEach(room => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
                <td>${room.id}</td>
                <td>${room.name}</td>
                <td>
                    <button class="btn btn-primary btn-sm" onclick="enterRoom(${room.id})">입장</button>
                </td>
            `;
        tbody.appendChild(tr);
      });
    } catch (err) {
      console.error('방 목록 불러오기 실패:', err);
      alert('방 목록을 불러오지 못했습니다.');
    }
  }

  async function createRoom() {
    const roomName = prompt('새 방 이름을 입력하세요:');
    if (!roomName) return;
    try {
      const room = await post('/api/chat/room/create', { name: roomName });
      alert(`방 생성 완료: ${room.name}`);
      loadRooms();
    } catch (err) {
      console.error('방 생성 실패:', err);
      alert('방 생성 실패: ' + err.message);
    }
  }

  function enterRoom(roomId) {
    window.location.href = `/chat/room/${roomId}`;
  }

  document.getElementById('create-room-btn').addEventListener('click', createRoom);

  // 페이지 로드 시 방 목록 가져오기
  loadRooms();
</script>
</body>
</html>
