<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Users Management</title>
    <link rel="stylesheet" href="/webjars/bootstrap/5.3.8/css/bootstrap.min.css">
    <script src="/webjars/bootstrap/5.3.8/js/bootstrap.bundle.min.js"></script>
</head>
<body class="bg-light">

<div class="container py-5">
    <h2 class="text-center mb-4">관리자 회원 관리</h2>

    <table class="table table-striped table-bordered shadow-sm">
        <thead class="table-dark">
        <tr>
            <th>Username</th>
            <th>Roles (comma-separated)</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody id="admin-users-tbody"></tbody>
    </table>

    <button class="btn btn-primary" onclick="loadUsers()">Refresh</button>
</div>

<script>
    function loadUsers() {
        fetch('/admin/users', { credentials: 'include' })
            .then(res => res.json())
            .then(users => {
                const tbody = document.getElementById('admin-users-tbody');
                tbody.innerHTML = '';
                users.forEach(user => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                    <td>${user.username}</td>
                    <td><input type="text" class="form-control" value="${user.roles}" id="roles-${user.username}"></td>
                    <td>
                        <button class="btn btn-sm btn-success me-1" onclick="updateRoles('${user.username}')">Update</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteUser('${user.username}')">Delete</button>
                    </td>`;
                    tbody.appendChild(tr);
                });
            });
    }

    function updateRoles(username) {
        const roles = document.getElementById(`roles-${username}`).value;
        fetch(`/admin/users/${username}/roles`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify({ roles })
        })
            .then(res => res.json())
            .then(data => alert(data.message));
    }

    function deleteUser(username) {
        fetch(`/admin/users/${username}`, {
            method: 'DELETE',
            credentials: 'include'
        })
            .then(res => res.json())
            .then(data => {
                alert(data.message);
                loadUsers();
            });
    }

    // 페이지 로드 시 목록 가져오기
    window.onload = loadUsers;
</script>

</body>
</html>