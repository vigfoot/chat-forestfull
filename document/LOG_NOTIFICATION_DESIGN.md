\# Chat-Forestfull – 로그 정책 및 알림 설계



\## 1. 목적

\- 결제, 채팅, 관리자 작업 등 시스템 이벤트 기록

\- 문제 발생 시 책임 추적 및 장애 분석

\- 사용자 알림 정책 정의



\## 2. 로그 정책



\### 2.1 로그 저장 위치

\- \*\*파일 로그\*\*: 서버 로컬 또는 Docker 볼륨에 저장

&nbsp; - 실시간 모니터링, 오류 분석 용도

\- \*\*DB 로그 (선택적)\*\*: 결제, 포인트 관련 이벤트 기록

&nbsp; - 테이블: `payment\_logs`, `user\_actions`, `admin\_actions`



\### 2.2 로그 항목

\- 결제 로그: 결제 완료, 취소, 환불, 상태 변경

\- 사용자 로그: 가입, 로그인, 채팅 활동, 임시 매니저 권한 사용

\- 관리자 로그: 채팅 관리, 강퇴, mute, 공지 발행, 권한 변경

\- 시스템 로그: WebSocket 연결 상태, SSE 이벤트 전송, 서버 오류



\### 2.3 로그 형식

\- JSON 또는 CSV 형식 권장

\- 항목: timestamp, userId, action, target, status, detail



\### 2.4 동시성 고려

\- 결제 및 권한 로그는 DB 원자적 트랜잭션 사용

\- 채팅 메시지 로그는 파일 append 방식, race condition 최소화

\- Redis 등 캐시 없이 파일 저장 시 동시 쓰기 충돌 가능 → 파일 Locking 필요



\## 3. 장애 및 알림 정책



\### 3.1 알림 대상

\- 서버 장애, Webhook 오류, 결제 실패 등 중요한 이벤트



\### 3.2 알림 방식

\- 사용자:

&nbsp; - 채팅 내 모달 팝업

&nbsp; - 공지 배너

\- 관리자:

&nbsp; - 이메일 알림 (서버 장애, 결제 오류 등)

&nbsp; - 관리자 UI에서 실시간 알림 표시



\### 3.3 알림 구현

\- WebSocket / SSE 이벤트 사용

\- 중요도 구분:

&nbsp; - High: 모달 + 관리자 이메일

&nbsp; - Normal: 상단 배너 / UI 알림



\### 3.4 재시도 정책

\- 결제 실패 / Webhook 처리 실패: 초당 1~3회 재시도

\- 재시도 실패 시 즉시 사용자 알림 및 반환 처리



