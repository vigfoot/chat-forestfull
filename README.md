# Chat-Forestfull – Project Overview

## 1. 프로젝트 개요
Chat-Forestfull은 틱톡 팔로워를 대상으로 한 실시간 커뮤니티 채팅 플랫폼입니다.  

## 2. 핵심 기능

### 2.1 회원가입 / 로그인
- TikTok OAuth 전용 로그인
- OAuth 토큰을 통해 사용자 정보(닉네임, 프로필 이미지, TikTok ID, 팔로우 정보) 수집
- 서버에서 JWT 발급 (액세스 토큰 30분, 리프레시 토큰 14일)
- 간단한 가입/로그인 절차로 진입 장벽 최소화

### 2.2 채팅방
- 단일 방 운영, 선별된 사용자만 접근 가능
- 접근 기준:
  - TikTok 팔로우 여부
  - OAuth 가입 승인 여부
- 메시지 저장: 이전 글 모두 접근 가능
- 신규 사용자 자동 승인 가능 (팔로우 확인 API 또는 관리자가 수동 승인)
- 멘션 기능: @username 패턴 감지, 실시간 하이라이트 및 알림

### 2.3 포인트 및 임시 매니저 기능
- 포인트 구매 시 주간 상위 1~3위 사용자에게 임시 매니저 권한 부여 (1주일)
- 임시 매니저 권한:
  - Mute: 일반 사용자 1시간, 주 10회
  - 특별 채팅: 사진+텍스트 업로드 가능
  - 사용 기록 저장 및 권한 자동 만료

### 2.4 결제 시스템 (PayPal)
- 결제/취소/환불 처리
- 결제 취소 시 포인트 및 권한 회수
- Webhook 안정화 및 Signature 검증
- Payment 상태 관리 (State Machine)
- 동시성 문제 처리
- 에러 처리: 초당 1~3회 재시도, 실패 시 사용자 반환 처리
- 결제 상태:
  - SUCCESS: 결제 완료
  - FAILED: 결제 실패
  - CANCELLED: 결제 취소
  - REFUNDED: 환불 완료

### 2.5 관리자 UI
- 간단한 템플릿 기반(Tymeleaf)
- URL 구조 예시: `/admin/users`, `/admin/payments`, `/admin/logs`
- 기능:
  - 사용자 관리: 가입 승인/접근 제한, 경고, 강퇴, mute, 임시 매니저 권한 발급/회수
  - 채팅 모니터링: 실시간 메시지, 금칙어 필터링
  - 공지 발행: 상단 배너, 채팅 상단, 모달 팝업
  - 결제/포인트 관리: 결제 로그 확인, 순위 확인
  - 시스템 로그/감사 기록
  - 이미지 업로드 관리

### 2.6 WebSocket / SSE
- WebSocket 기반 실시간 채팅
- JWT 핸드셰이크 인증
- 최대 동시 접속: 100명 예상
- 연결 유지 정책:
  - Heartbeat: 주기적 ping/pong (예: 30초)
  - 연결 끊김 시 재연결
  - 서버 재시작 시 클라이언트 자동 재연결
- SSE는 알림/공지용 병행 가능

### 2.7 로그 및 알림
- 로그 정책:
  - Payment 관련: DB와 파일 두 가지
  - 일반 채팅 이벤트: 선택적으로 파일 저장
- 장애 알림:
  - 서버 장애 발생 시 관리자 모달 알림
  - 틱톡 연동 이메일 발송

## 3. 배포 환경
- 단일 인스턴스: Frontend + Backend 통합
- Docker container: Spring Boot 443:8080
- nginx 443 사용, 기존 HTTPS 인증서 활용
- Redis 캐싱 없음
- 동접자 약 30명 예상
- 백업/복구 전략: 선택 사항, 추후 구현 가능

## 4. 필수 고려 사항
- PayPal Webhook Signature 검증
- Payment 상태 관리(State Machine) 정의
- 동시성 문제 처리
- 에러 처리 정책 (결제 관련)
- Socket/SSE 연결 유지 정책
- 관리자 UI 완성도 유지
- Docker 컨테이너화
- 성능 테스트
